{"paragraphs":[{"text":"%md\n# 1. Exploratory data analysis of dataset from the Lab\n#### First, We will do some exercise using the data we also used in Spark Lab on our course Lab page.\n#### We need to import some libraries first,","dateUpdated":"2018-03-14T22:36:20+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>1. Exploratory data analysis of dataset from the Lab</h1>\n<h4>First, We will do some exercise using the data we also used in Spark Lab on our course Lab page.</h4>\n<h4>We need to import some libraries first,</h4>\n"}]},"apps":[],"jobName":"paragraph_1521066980028_-1167525074","id":"20161018-061641_440214063","dateCreated":"2018-03-14T22:36:20+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:233"},{"text":"// any import statements go here\n\nimport org.apache.commons.io.IOUtils\nimport java.net.URL\nimport java.nio.charset.Charset\n","user":"anonymous","dateUpdated":"2018-03-17T19:43:03+0000","config":{"colWidth":12,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.commons.io.IOUtils\nimport java.net.URL\nimport java.nio.charset.Charset\n"}]},"apps":[],"jobName":"paragraph_1521066980050_-1174450554","id":"20161018-061641_596592926","dateCreated":"2018-03-14T22:36:20+0000","dateStarted":"2018-03-17T19:43:03+0000","dateFinished":"2018-03-17T19:43:05+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:234"},{"text":"%md\n#### Then, load data. We uploaded the data on S3 for easier loading","dateUpdated":"2018-03-14T22:36:20+0000","config":{"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>Then, load data. We uploaded the data on S3 for easier loading</h4>\n"}]},"apps":[],"jobName":"paragraph_1521066980062_-1179067541","id":"20161018-061641_336159439","dateCreated":"2018-03-14T22:36:20+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:235"},{"text":"// load raw data\n\nval rawCaseEvents = sc.parallelize(\n    IOUtils.toString(\n        new URL(\"https://s3.amazonaws.com/cse8803-rlu39/hw4/case.csv\"),\n        Charset.forName(\"utf8\")).split(\"\\n\"))\n        \nval rawControlEvents = sc.parallelize(\n    IOUtils.toString(\n        new URL(\"https://s3.amazonaws.com/cse8803-rlu39/hw4/control.csv\"),\n        Charset.forName(\"utf8\")).split(\"\\n\"))","user":"anonymous","dateUpdated":"2018-03-17T19:43:08+0000","config":{"colWidth":12,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"rawCaseEvents: org.apache.spark.rdd.RDD[String] = ParallelCollectionRDD[682] at parallelize at <console>:36\nrawControlEvents: org.apache.spark.rdd.RDD[String] = ParallelCollectionRDD[683] at parallelize at <console>:35\n"}]},"apps":[],"jobName":"paragraph_1521066980070_-1194457497","id":"20161018-061641_1949699663","dateCreated":"2018-03-14T22:36:20+0000","dateStarted":"2018-03-17T19:43:08+0000","dateFinished":"2018-03-17T19:43:11+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:236"},{"text":"%md\n#### Also, define case class for transforming into DataFrame","dateUpdated":"2018-03-14T22:36:20+0000","config":{"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>Also, define case class for transforming into DataFrame</h4>\n"}]},"apps":[],"jobName":"paragraph_1521066980078_-1197535488","id":"20161018-061641_149266468","dateCreated":"2018-03-14T22:36:20+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:237"},{"text":"// Define case class\ncase class Event(patientId: String, category: String, event: String, dateOffSet: String, value: Double)","user":"anonymous","dateUpdated":"2018-03-17T19:43:14+0000","config":{"colWidth":12,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"defined class Event\n"}]},"apps":[],"jobName":"paragraph_1521066980080_-1187532017","id":"20161018-061641_460627980","dateCreated":"2018-03-14T22:36:20+0000","dateStarted":"2018-03-17T19:43:15+0000","dateFinished":"2018-03-17T19:43:16+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:238"},{"text":"%md\n#### Now, you should transform the raw dat into DataFrame using defined case class, and register it as table","dateUpdated":"2018-03-14T22:36:20+0000","config":{"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>Now, you should transform the raw dat into DataFrame using defined case class, and register it as table</h4>\n"}]},"apps":[],"jobName":"paragraph_1521066980085_-1189455761","id":"20161018-061641_95912425","dateCreated":"2018-03-14T22:36:20+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:239"},{"text":"//construct dataframe\n//TODO: transform raw data into Event\nval case_Events = rawCaseEvents.map(line => line.split(\",\"))\nval caseEvents = case_Events.map(x => Event(x(0),\"case\",x(1),x(2),x(3).toDouble))\n\nval control_Events = rawControlEvents.map(line => line.split(\",\"))\nval controlEvents = control_Events.map(x => Event(x(0),\"control\",x(1),x(2),x(3).toDouble))\n\nval Events = caseEvents.union(controlEvents).toDF()\nEvents.registerTempTable(\"Events\")","user":"anonymous","dateUpdated":"2018-03-17T19:43:20+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"results":{},"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"case_Events: org.apache.spark.rdd.RDD[Array[String]] = MapPartitionsRDD[684] at map at <console>:38\ncaseEvents: org.apache.spark.rdd.RDD[Event] = MapPartitionsRDD[685] at map at <console>:40\ncontrol_Events: org.apache.spark.rdd.RDD[Array[String]] = MapPartitionsRDD[686] at map at <console>:37\ncontrolEvents: org.apache.spark.rdd.RDD[Event] = MapPartitionsRDD[687] at map at <console>:40\nEvents: org.apache.spark.sql.DataFrame = [patientId: string, category: string ... 3 more fields]\nwarning: there was one deprecation warning; re-run with -deprecation for details\n"}]},"apps":[],"jobName":"paragraph_1521066980090_-1189840510","id":"20161018-061641_1387391725","dateCreated":"2018-03-14T22:36:20+0000","dateStarted":"2018-03-17T19:43:20+0000","dateFinished":"2018-03-17T19:43:27+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:240"},{"text":"%md\n#### Also, make a query and visualize top 10 CASE patient with the highest payment","dateUpdated":"2018-03-14T22:36:20+0000","config":{"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>Also, make a query and visualize top 10 CASE patient with the highest payment</h4>\n"}]},"apps":[],"jobName":"paragraph_1521066980097_-1107888995","id":"20161018-061641_515282949","dateCreated":"2018-03-14T22:36:20+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:241"},{"text":"%sql\n--TODO: Show the top 10 payment for case patients\nselect patientId, sum(value) as value from Events\nwhere category = 'case'\ngroup by patientId\norder by value DESC\nlimit 10","user":"anonymous","dateUpdated":"2018-03-17T19:44:19+0000","config":{"colWidth":12,"graph":{"mode":"multiBarChart","height":300,"optionOpen":true,"keys":[{"name":"patientId","index":0,"aggr":"sum"}],"values":[{"name":"value","index":1,"aggr":"sum"}],"groups":[],"scatter":{}},"enabled":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":357.4,"optionOpen":true,"setting":{"multiBarChart":{"stacked":false}},"commonSetting":{},"keys":[{"name":"patientId","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"value","index":1,"aggr":"sum"}]},"helium":{}}},"editorSetting":{"language":"sql"},"editorMode":"ace/mode/sql","lineNumbers":true,"title":false},"settings":{"params":{"patientId":""},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"patientId\tvalue\n0085B4F55FFA358D\t140309.0\n019E4729585EF3DD\t115479.0\n01AC552BE839AB2B\t109008.0\n00291F39917544B1\t103552.0\n0103899F68F866F0\t101969.0\n01BE015FAF3D32D1\t88858.0\n002AB71D3224BE66\t86999.0\n01A999551906C787\t85196.0\n01546ADB01630C6C\t72610.0\n0007F12A492FD25D\t69046.0\n"}]},"apps":[],"jobName":"paragraph_1521066980098_-1106734748","id":"20161018-061641_1706459139","dateCreated":"2018-03-14T22:36:20+0000","dateStarted":"2018-03-17T19:43:34+0000","dateFinished":"2018-03-17T19:43:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:242"},{"text":"%md\n#### Similarly, make a query and visualize top 10 CONTROL patient with the highest payment","dateUpdated":"2018-03-14T22:36:20+0000","config":{"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>Similarly, make a query and visualize top 10 CONTROL patient with the highest payment</h4>\n"}]},"apps":[],"jobName":"paragraph_1521066980100_-1109043241","id":"20161018-061641_814643488","dateCreated":"2018-03-14T22:36:20+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:243"},{"text":"%sql\n--TODO: Show the top 10 payment for control patients\nselect patientId, sum(value) as value from Events\nwhere category = 'control'\ngroup by patientId\norder by value DESC\nlimit 10","user":"anonymous","dateUpdated":"2018-03-17T19:44:29+0000","config":{"colWidth":12,"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"keys":[{"name":"patientId","index":0,"aggr":"sum"}],"values":[{"name":"value","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"patientId","index":0,"aggr":"sum"},"yAxis":{"name":"value","index":1,"aggr":"sum"}}},"enabled":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false},"helium":{}}},"editorSetting":{"language":"sql"},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"patientId\tvalue\n51A115C3BD10C42B\t77020.0\nF637376B77D2F010\t57325.0\nB41CB1CEEC8D7830\t57076.0\nD647CA159ADBE7D9\t46806.0\n55C132E4963DB106\t41093.0\n8638D8F6AD637029\t39076.0\n2B71DDD890E5DB0E\t38406.0\n90B91E29ABA6CB82\t36280.0\n2368FF7CF1C52133\t35054.0\n834B8F485CBC597C\t33780.0\n"}]},"apps":[],"jobName":"paragraph_1521066980103_-1108658492","id":"20161018-061641_1504853191","dateCreated":"2018-03-14T22:36:20+0000","dateStarted":"2018-03-17T19:44:30+0000","dateFinished":"2018-03-17T19:44:34+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:244"},{"text":"// Define helper function if needed\ndef getEventType(s: String): String = {\n    s match {\n    case diag: String if diag.startsWith(\"DIAG\") => \"DIAG\"\n    case drug: String if drug.startsWith(\"DRUG\") => \"DRUG\"\n    case proc: String if proc.startsWith(\"PROC\") => \"procedure\"\n    case \"PAYMENT\" => \"payment\"\n    case \"heartfailure\" => \"heart failure\"\n    case _ => \"otherwise\"\n    }\n}\n\nsqlc.udf.register(\"getEventType\", getEventType _)","user":"anonymous","dateUpdated":"2018-03-17T19:44:47+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"results":{},"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"getEventType: (s: String)String\nres58: org.apache.spark.sql.expressions.UserDefinedFunction = UserDefinedFunction(<function1>,StringType,Some(List(StringType)))\n"}]},"apps":[],"jobName":"paragraph_1521066980104_-1110582237","id":"20161018-061641_1152670418","dateCreated":"2018-03-14T22:36:20+0000","dateStarted":"2018-03-17T19:44:47+0000","dateFinished":"2018-03-17T19:44:51+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:245"},{"text":"%md\n#### Next, write a query and visualize the number of CASE/CONTROL patients for each type of event\n##### Hint: You can use `getEventType` defined above","dateUpdated":"2018-03-14T22:36:20+0000","config":{"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>Next, write a query and visualize the number of CASE/CONTROL patients for each type of event</h4>\n<h5>Hint: You can use <code>getEventType</code> defined above</h5>\n"}]},"apps":[],"jobName":"paragraph_1521066980105_-1110966986","id":"20161018-061641_481735739","dateCreated":"2018-03-14T22:36:20+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:246"},{"text":"%sql\nselect case_table.type, control_table.count as control, case_table.count as case from \n(select getEventType(event) type, count(*) count from Events\nwhere category = 'case' \ngroup by getEventType(event) \norder by count desc) as case_table\ninner join\n(select getEventType(event) type, count(*) count from Events\nwhere category ='control' \ngroup by getEventType(event) \norder by count desc) as control_table\non control_table.type = case_table.type\norder by case_table.count desc\n","user":"anonymous","dateUpdated":"2018-03-17T19:44:59+0000","config":{"colWidth":12,"enabled":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":true,"setting":{"multiBarChart":{}},"commonSetting":{},"keys":[{"name":"type","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"control","index":1,"aggr":"sum"},{"name":"case","index":2,"aggr":"sum"}]},"helium":{}}},"editorSetting":{"language":"sql","editOnDblClick":false},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"type\tcontrol\tcase\nDRUG\t10054\t6197\nDIAG\t5011\t5809\npayment\t1656\t1603\nprocedure\t177\t337\nheart failure\t200\t100\n"}]},"apps":[],"jobName":"paragraph_1521074763968_-16498398","id":"20180315-004603_1757514833","dateCreated":"2018-03-15T00:46:03+0000","dateStarted":"2018-03-17T19:44:59+0000","dateFinished":"2018-03-17T19:45:21+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:247"},{"text":"%md\n# 2. Descriptive statistics for HW4 Data\n### Now, let's move to our HW4 again.\n#### First of all, we will define some case classes first.","dateUpdated":"2018-03-14T22:36:20+0000","config":{"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>2. Descriptive statistics for HW4 Data</h1>\n<h3>Now, let's move to our HW4 again.</h3>\n<h4>First of all, we will define some case classes first.</h4>\n"}]},"apps":[],"jobName":"paragraph_1521066980115_-1100963514","id":"20161018-061641_1240329920","dateCreated":"2018-03-14T22:36:20+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:248"},{"text":"// Define case classes to make it easier to transform to DataFrame\n\ncase class Patient(patientID: String, sex: String, dob: String, dod: String)\ncase class LabResult(patientID: String, date: Long, labName: String, value: String)\ncase class Diagnostic(patientID: String, date: Long, icd9code: String, sequence: Int)\ncase class Medication(patientID: String, date: Long, medicine: String)","user":"anonymous","dateUpdated":"2018-03-17T19:45:33+0000","config":{"colWidth":12,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"defined class Patient\ndefined class LabResult\ndefined class Diagnostic\ndefined class Medication\n"}]},"apps":[],"jobName":"paragraph_1521066980117_-1103272008","id":"20161018-061641_601204011","dateCreated":"2018-03-14T22:36:20+0000","dateStarted":"2018-03-17T19:45:33+0000","dateFinished":"2018-03-17T19:45:36+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:249"},{"text":"%md\n#### Then, we need to load hw4 data already given to you.\n#### Be careful, you need to CHANGE the path of the file properly.\n#### Also, it would be convenient for you to set up shared folder, if you are using Zeppelin on a virtual environment.\n#### Make given sample code work first, then complete the next loading part also.","dateUpdated":"2018-03-14T22:36:20+0000","config":{"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>Then, we need to load hw4 data already given to you.</h4>\n<h4>Be careful, you need to CHANGE the path of the file properly.</h4>\n<h4>Also, it would be convenient for you to set up shared folder, if you are using Zeppelin on a virtual environment.</h4>\n<h4>Make given sample code work first, then complete the next loading part also.</h4>\n"}]},"apps":[],"jobName":"paragraph_1521066980119_-1102502510","id":"20161018-061641_525253742","dateCreated":"2018-03-14T22:36:20+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:250"},{"text":"// Read patient data from CSV into a dataframe. Make sure to not use the header!\n// Change the file path as required\n\nval patient = sc.textFile(\"file:///hw4_data/PATIENT.csv\")\n    .map(line => line.split(\",\"))\n    .filter(line => !line(0).contains(\"subject_id\"))\n    .map(line => Patient(line(0), line(1), line(2), line(3)))\n    .toDF()","user":"anonymous","dateUpdated":"2018-03-17T19:46:15+0000","config":{"colWidth":12,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"patient: org.apache.spark.sql.DataFrame = [patientID: string, sex: string ... 2 more fields]\n"}]},"apps":[],"jobName":"paragraph_1521066980124_-1105965250","id":"20161018-061641_1781852624","dateCreated":"2018-03-14T22:36:20+0000","dateStarted":"2018-03-17T19:45:43+0000","dateFinished":"2018-03-17T19:45:46+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:251"},{"text":"// TODO: Similarly, read in Diagnostic. Make sure to read only the relevant columns (subject_id, date, code, sequence)\nimport java.lang.Long\nval diagnostic = sc.textFile(\"file:///hw4_data/DIAGNOSTIC.csv\")\n    .map(line=> line.split(\",\"))\n    .filter(line => !line(0).contains(\"subject_id\"))\n    .map(line =>Diagnostic(line(0),line(1).toLong,line(3),line(4).toInt))\n    .toDF()\n\n","user":"anonymous","dateUpdated":"2018-03-17T19:46:31+0000","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import java.lang.Long\ndiagnostic: org.apache.spark.sql.DataFrame = [patientID: string, date: bigint ... 2 more fields]\n"}]},"apps":[],"jobName":"paragraph_1521066980126_-1105195752","id":"20161018-061641_937594153","dateCreated":"2018-03-14T22:36:20+0000","dateStarted":"2018-03-17T19:46:15+0000","dateFinished":"2018-03-17T19:46:19+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:252"},{"text":"// Register the DataFrames as temp table to use SQL queries\npatient.toDF().registerTempTable(\"patient\")\ndiagnostic.toDF().registerTempTable(\"diagnostic\")","user":"anonymous","dateUpdated":"2018-03-17T19:46:31+0000","config":{"colWidth":12,"results":[],"enabled":true,"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there was one deprecation warning; re-run with -deprecation for details\nwarning: there was one deprecation warning; re-run with -deprecation for details\n"}]},"apps":[],"jobName":"paragraph_1521066980127_-1105580501","id":"20161018-061641_2057411432","dateCreated":"2018-03-14T22:36:20+0000","dateStarted":"2018-03-17T19:46:32+0000","dateFinished":"2018-03-17T19:46:33+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:253"},{"text":"%md\n#### Now that we have successfully loaded the data as tables, we can query them to do analysis.\n#### Discover the gender distribution in hw4 dataset. What are the number of male and female patients?","dateUpdated":"2018-03-14T22:36:20+0000","config":{"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>Now that we have successfully loaded the data as tables, we can query them to do analysis.</h4>\n<h4>Discover the gender distribution in hw4 dataset. What are the number of male and female patients?</h4>\n"}]},"apps":[],"jobName":"paragraph_1521066980135_-1120970457","id":"20161018-061641_132253630","dateCreated":"2018-03-14T22:36:20+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:254"},{"text":"%sql\nselect sum(case when sex = 'F' then 1 else 0 end) as female, sum(case when sex ='M'then 1 else 0 end) as male\nfrom patient\n-- TODO: Write a SQL query to determine the number of male and female patients in the data","user":"anonymous","dateUpdated":"2018-03-17T19:46:59+0000","config":{"colWidth":12,"editorHide":false,"graph":{"mode":"pieChart","height":300,"optionOpen":true,"keys":[{"name":"sex","index":0,"aggr":"sum"}],"values":[{"name":"_c1","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"sex","index":0,"aggr":"sum"},"yAxis":{"name":"_c1","index":1,"aggr":"sum"}}},"enabled":true,"results":{"0":{"graph":{"mode":"pieChart","height":300,"optionOpen":true,"setting":{"multiBarChart":{}},"commonSetting":{},"keys":[],"groups":[],"values":[{"name":"male","index":1,"aggr":"sum"},{"name":"female","index":0,"aggr":"sum"}]},"helium":{}}},"editorSetting":{"language":"sql"},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"female\tmale\n443\t555\n"}]},"apps":[],"jobName":"paragraph_1521066980136_-1122894202","id":"20161018-061641_141184765","dateCreated":"2018-03-14T22:36:20+0000","dateStarted":"2018-03-17T19:47:00+0000","dateFinished":"2018-03-17T19:47:00+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:255"},{"text":"%md\n#### Next, get the top 10 ICD-9 codes in diagnostics (by number of occurrences). For these top 10 codes, show the breakdown by sex.\n#### Write a SQL query and make a chart similar with the one in the homework description PDF.","dateUpdated":"2018-03-17T19:47:21+0000","config":{"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h4>Next, get the top 10 ICD-9 codes in diagnostics (by number of occurrences). For these top 10 codes, show the breakdown by sex.</h4>\n<h4>Write a SQL query and make a chart similar with the one in the homework description PDF.</h4>\n</div>"}]},"apps":[],"jobName":"paragraph_1521066980137_-1123278951","id":"20161018-061641_2070399067","dateCreated":"2018-03-14T22:36:20+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:256","user":"anonymous","dateFinished":"2018-03-17T19:47:21+0000","dateStarted":"2018-03-17T19:47:21+0000"},{"text":"%sql\n-- TODO: Write a SQL query to show the breakdown of count of the overall top 10 ICD-9 codes among male and female patients\n-- Try to do this in a single call without creating intermediate tables (use nested queries and/or joins)\nSELECT patient.sex, diag.icd9code,count(*) as c\nfrom  patient, diagnostic diag\nwhere patient.patientID = diag.patientID AND diag.icd9code IN (select icd9code from (select icd9code,COUNT(*) as total from diagnostic group by icd9code order by total DESC limit 10 ))\ngroup by sex,icd9code \norder by c desc\n\n\n","user":"anonymous","dateUpdated":"2018-03-17T19:47:25+0000","config":{"colWidth":12,"enabled":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":true,"setting":{"multiBarChart":{"stacked":false}},"commonSetting":{},"keys":[{"name":"icd9code","index":1,"aggr":"sum"}],"groups":[{"name":"sex","index":0,"aggr":"sum"}],"values":[{"name":"c","index":2,"aggr":"sum"}]},"helium":{}}},"editorSetting":{"language":"sql","editOnDblClick":false},"editorMode":"ace/mode/sql","lineNumbers":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"sex\ticd9code\tc\nM\t401.9\t203\nM\t414.01\t182\nF\t401.9\t164\nM\t428.0\t124\nM\t427.31\t110\nF\t428.0\t106\nM\t272.0\t89\nF\tV29.0\t80\nM\tV29.0\t78\nM\tV05.3\t77\nF\tV05.3\t77\nF\t414.01\t75\nM\t584.9\t73\nF\t427.31\t73\nF\t599.0\t65\nM\t250.00\t62\nF\t584.9\t61\nF\t250.00\t56\nF\t272.0\t43\nM\t599.0\t39\n"}]},"apps":[],"jobName":"paragraph_1521101375353_1913092844","id":"20180315-080935_537137417","dateCreated":"2018-03-15T08:09:35+0000","dateStarted":"2018-03-17T19:47:25+0000","dateFinished":"2018-03-17T19:47:41+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:257"},{"text":"%md\n# 3. Patient Similarity\nWe will use the list of similar patients you found in Q3 Random Walk with Restart or from Q2 Jaccard Similarity if you could not complete it. If you couldn't complete them both, your out of luck. To get the patient ids, check your output from either line in `Main.scala` then make a List or Set manually or save your results from your application as an RDD to load here.\n\n```\nprintln(Jaccard.jaccardSimilarityOneVsAll(patientGraph, 9))\nprintln(RandomWalk.randomWalkOneVsAll(patientGraph, 9))\n```","dateUpdated":"2018-03-14T22:36:20+0000","config":{"tableHide":false,"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>3. Patient Similarity</h1>\n<p>We will use the list of similar patients you found in Q3 Random Walk with Restart or from Q2 Jaccard Similarity if you could not complete it. If you couldn't complete them both, your out of luck. To get the patient ids, check your output from either line in <code>Main.scala</code> then make a List or Set manually or save your results from your application as an RDD to load here.</p>\n<pre><code>println(Jaccard.jaccardSimilarityOneVsAll(patientGraph, 9))\nprintln(RandomWalk.randomWalkOneVsAll(patientGraph, 9))\n</code></pre>\n"}]},"apps":[],"jobName":"paragraph_1521066980146_-1112890730","id":"20161018-061641_1818607372","dateCreated":"2018-03-14T22:36:20+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:258"},{"text":"// TODO - Add the patient ids here or load your RDD / dataframe result\n// and register them into a temp table\n\nval list_similar_patients = List(634, 433, 145, 720, 689, 441, 914, 801, 353, 781) // change this\n\nval similar_patients = sc.parallelize(list_similar_patients)\n    .toDF(\"patientID\")\nsimilar_patients.registerTempTable(\"similar_patients\")\n\n// a helper method if you decide to use it to group your patients by dead and alive\ndef getDeadOrAlive(s: String): String = {\n   if (s.isEmpty()) \"Alive\" else \"Dead\"\n}\n\nsqlc.udf.register(\"getDeadOrAlive\", getDeadOrAlive _)","user":"anonymous","dateUpdated":"2018-03-17T19:47:59+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","tableHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"list_similar_patients: List[Int] = List(634, 433, 145, 720, 689, 441, 914, 801, 353, 781)\nsimilar_patients: org.apache.spark.sql.DataFrame = [patientID: int]\nwarning: there was one deprecation warning; re-run with -deprecation for details\ngetDeadOrAlive: (s: String)String\nres76: org.apache.spark.sql.expressions.UserDefinedFunction = UserDefinedFunction(<function1>,StringType,Some(List(StringType)))\n"}]},"apps":[],"jobName":"paragraph_1521066980148_-1115199224","id":"20161018-061641_199353453","dateCreated":"2018-03-14T22:36:20+0000","dateStarted":"2018-03-17T19:47:59+0000","dateFinished":"2018-03-17T19:48:09+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:259"},{"text":"%sql\n-- TODO: Display the gender ratio in similar patients, change the visualization to a more appropriate one\n\nSELECT\n    SUM(CASE WHEN patient.sex='F' THEN 1 ELSE 0 end)/10 AS female,\n    SUM( CASE WHEN patient.sex='M' THEN 1 ELSE 0 end)/10 AS male\nFROM similar_patients sim\n    LEFT JOIN patient ON (sim.patientID = patient.patientID)","user":"anonymous","dateUpdated":"2018-03-17T19:48:15+0000","config":{"colWidth":6,"editorMode":"ace/mode/sql","results":[{"graph":{"mode":"pieChart","height":300,"optionOpen":true,"keys":[],"values":[{"name":"male","index":1,"aggr":"sum"},{"name":"female","index":0,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"patientID","index":0,"aggr":"sum"}},"setting":{"multiBarChart":{},"pieChart":{}},"commonSetting":{}},"helium":{}}],"enabled":true,"editorSetting":{"language":"sql"},"lineNumbers":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"female\tmale\n0.7\t0.3\n"}]},"apps":[],"jobName":"paragraph_1521066980149_-1115583973","id":"20161018-061641_458995251","dateCreated":"2018-03-14T22:36:20+0000","dateStarted":"2018-03-17T19:48:15+0000","dateFinished":"2018-03-17T19:48:23+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:260"},{"text":"%sql\n-- TODO: Display the ratio of alive/dead patients in similar patients, change the visualization to a more appropriate one\n\nSELECT\n    SUM(CASE WHEN patient.dod = '' THEN 1 ELSE 0 end)/10 AS alive,\n    SUM( CASE WHEN patient.dod!='' THEN 1 ELSE 0 end)/10 AS dead\nFROM similar_patients sim\n    LEFT JOIN patient ON (sim.patientID = patient.patientID)","user":"anonymous","dateUpdated":"2018-03-17T19:48:30+0000","config":{"colWidth":6,"editorMode":"ace/mode/sql","results":[{"graph":{"mode":"pieChart","height":300,"optionOpen":true,"keys":[],"values":[{"name":"dead","index":1,"aggr":"sum"},{"name":"alive","index":0,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"patientID","index":0,"aggr":"sum"}},"setting":{"pieChart":{}},"commonSetting":{}},"helium":{}}],"enabled":true,"editorSetting":{"language":"sql"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"alive\tdead\n0.4\t0.6\n"}]},"apps":[],"jobName":"paragraph_1521066980150_-1114429726","id":"20161018-061641_571923533","dateCreated":"2018-03-14T22:36:20+0000","dateStarted":"2018-03-17T19:48:30+0000","dateFinished":"2018-03-17T19:48:35+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:261"},{"text":"","dateUpdated":"2018-03-14T22:36:20+0000","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521066980151_-1114814475","id":"20161018-061641_182015159","dateCreated":"2018-03-14T22:36:20+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:262"}],"name":"BDH_HW4_Zeppelin","id":"2DB74KJ97","angularObjects":{"2D5RDPRKP:shared_process":[],"2D66X8G11:shared_process":[],"2D6YFX1WH:shared_process":[],"2D8CJBMCX:shared_process":[],"2D59QTM13:shared_process":[],"2D6E812D3:shared_process":[],"2D889515X:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}